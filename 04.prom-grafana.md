# üìä Monitoring OpenSearch Using Prometheus & Grafana

## ‚úÖ What‚Äôs Covered

- Setup of Prometheus Exporter Plugin for OpenSearch
- Docker-based deployment of Prometheus and Grafana
- Configuration of Prometheus to scrape OpenSearch metrics
- Connecting Prometheus as a datasource to Grafana
- Live visualization of OpenSearch performance metrics
- Troubleshooting and networking challenges resolved

---
Demo link : https://drive.google.com/file/d/1om6Ps7ZWgvhNQV2K6Qn0habvUfbElaRf/view?usp=sharing

---

## üìÅ Project Structure

```

open-search.
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ prometheus.yml
‚îî‚îÄ‚îÄ opensearch-exporter
       |
       |___config/opensearch.yml
       |
       |___Dockerfile
```

---

## üöÄ Steps Followed

##1.docker-compose.yml
```
version: "3.8"

services:
  opensearch-node1:
    build:
      context: ./opensearch-exporter
      dockerfile: Dockerfile
    container_name: opensearch-node1
    environment:
      - cluster.name=opensearch-cluster
      - node.name=opensearch-node1
      - discovery.type=single-node
      - bootstrap.memory_lock=true
      - "OPENSEARCH_JAVA_OPTS=-Xms512m -Xmx512m"
      - plugins.security.disabled=true
      - OPENSEARCH_INITIAL_ADMIN_PASSWORD=L*van**jc@**
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - opensearch-data:/usr/share/opensearch/data
    ports:
      - 9200:9200
      - 9600:9600
    networks:
      - opensearch-net
    healthcheck:
      test: ["CMD", "curl", "-s", "http://localhost:9200"]
      interval: 10s
      timeout: 5s
      retries: 10

  opensearch-dashboards:
    image: opensearchproject/opensearch-dashboards:2.14.0
    container_name: opensearch-dashboards
    environment:
      - OPENSEARCH_HOSTS=http://opensearch-node1:9200
      - DISABLE_SECURITY_DASHBOARDS_PLUGIN=true
    ports:
      - 5601:5601
    depends_on:
      opensearch-node1:
        condition: service_healthy
    networks:
      - opensearch-net

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - 9090:9090
    networks:
      - opensearch-net

 grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - 3000:3000
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=Lavanyajc@11
    depends_on:
      - prometheus
    networks:
      - opensearch-net
    volumes:
      - grafana-storage:/var/lib/grafana

volumes:
  opensearch-data:

networks:
  opensearch-net:
    driver: bridge

```

## prometheus.yml
```
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'opensearch'
    metrics_path: /_prometheus/metrics
    static_configs:
      - targets: ['opensearch-node1:9200']

* `9600` is the default port where the OpenSearch Prometheus Exporter exposes metrics.
* Used `host.docker.internal` to resolve the host IP inside Docker on Windows.

---

##Dockerfile

``
FROM opensearchproject/opensearch:2.14.0

USER root

# Download Prometheus exporter plugin zip file
RUN curl -L -o /tmp/prometheus-exporter.zip https://github.com/aiven/prometheus-exporter-plugin-for-opensearch/releases/download/2.14.0.0/prometheus-exporter-2.14.0.0.zip \
    && chown opensearch:opensearch /tmp/prometheus-exporter.zip

USER opensearch

# Install the plugin
RUN /usr/share/opensearch/bin/opensearch-plugin install --batch file:///tmp/prometheus-exporter.zip

# Expose OpenSearch and Prometheus exporter ports
EXPOSE 9200 9600

````
---
##opensearch.yml
```
network.host: 0.0.0.0
discovery.type: single-node

plugins.prometheus.host: 0.0.0.0
plugins.prometheus.port: 9600

```
---
```
### . üì• Download Prometheus Exporter Plugin

Used official plugin:

```

[https://github.com/aiven/prometheus-exporter-plugin-for-opensearch/releases/download/2.14.0.0/prometheus-exporter-2.14.0.0.zip](https://github.com/aiven/prometheus-exporter-plugin-for-opensearch/releases/download/2.14.0.0/prometheus-exporter-2.14.0.0.zip)

````
Placed the ZIP under `./plugins` to be mounted into the OpenSearch container.
---

### 2. üê≥ Docker Compose File

Here‚Äôs how the services were defined:

#### ‚úÖ Services:

- **OpenSearch** with the Prometheus Exporter plugin pre-installed
- **Prometheus** configured to scrape metrics from OpenSearch
- **Grafana** for visualization

#### üö® Port Mapping:

| Service     | Internal | Host          |
|-------------|----------|---------------|
| OpenSearch  | 9200     | 9200          |
| Prometheus  | 9090     | 9090          |
| Grafana     | 3000     | 3000          |

---



## üß™ Testing the Setup

### ‚úÖ OpenSearch:

* Exposed on [http://localhost:9200](http://localhost:9200)

### ‚úÖ Prometheus:

* UI: [http://localhost:9090](http://localhost:9090)
* Successfully queried `http://host.docker.internal:9600/metrics`
* Confirmed data is visible from target

### ‚úÖ Grafana:

* UI: [http://localhost:3000](http://localhost:3000)

* Default creds: `admin/admin`

* Added Prometheus as a Data Source using:

  ```
  URL: http://host.docker.internal:9090
  ```

* Query tested: `up` ‚Äî confirmed connection

---

## üêû Errors Faced & Fixes

| ‚ùå Issue                                                                            | ‚úÖ Solution                                                                                                                         |
| ---------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| Prometheus could not connect to OpenSearch Exporter: `connect: connection refused` | Used `host.docker.internal` instead of `localhost` to ensure cross-container visibility (especially on Docker Desktop for Windows) |
| Grafana showed no data sources                                                     | Restarted Grafana after Prometheus was up                                                                                          |
| Port `9600` not exposed                                                            | Explicitly exposed in Docker Compose                                                                                               |
| Prometheus endpoint showed `connection refused`                                    | Made sure container was running and `prometheus.yml` had correct target                                                            |

---

## üìä Visualization Example

Once the data source was added, explored metrics like:

* `opensearch_breakers_parent_estimated_size_bytes`
* `opensearch_cluster_health_status`
* `opensearch_indices_docs_count`

---

## üß† Key Learnings

* Plugin integration is vital for exporting OpenSearch metrics.
* `host.docker.internal` is a crucial trick for container-to-host communication on Windows.
* Prometheus and Grafana can be containerized for quick observability setup.
* Real-time monitoring of OpenSearch is now live and visual.

---


